# Relat√≥rio de Trabalho - WebQuizMedicina
üìÖ **Data**: 09 de Dezembro de 2025

---

## ‚è±Ô∏è Resumo de Tempo
* **Hora de In√≠cio**: 08:00
* **Hora de Fim**: 21:45 (Estimado)
* **Tempo Total**: ~3 horas e 45 minutos
* **Sess√µes**: 2 tarefas

---

## üìã Sess√µes de Trabalho

### Sess√£o 1: 08:00 - 09:00 (60 min) ‚úÖ
**Debug e Corre√ß√£o de Permiss√µes Firestore**
* Identifica√ß√£o da causa raiz do erro `permission-denied` em `user_profiles`.
* Diagn√≥stico revelou que o problema ocorria na listagem de admin (`useAdminUsers`) que tentava ler a cole√ß√£o inteira.
* Corre√ß√£o das regras de seguran√ßa (`firestore.rules`) para permitir explicitamente que o admin leia todos os documentos de `user_profiles` e `projects`.
* Cria√ß√£o de helper `isAdmin()` nas regras para reutiliza√ß√£o.
* Arquivo modificado: `firestore.rules`.
* Documenta√ß√£o atualizada em `docs/LESSONS.md` com o aprendizado sobre queries de cole√ß√£o.
* Comando executado: `firebase deploy --only firestore:rules`.

### Sess√£o 2: 21:00 - 21:45 (45 min) ‚úÖ
**Corre√ß√£o do Erro "Transaction too big" ao Processar Embeddings de PDFs**
* An√°lise detalhada dos logs de erro do Firebase mostrando falha no processamento de embeddings de PDFs.
* **Diagn√≥stico**: Erro `Transaction too big. Decrease transaction size` ocorria ao tentar salvar 50 embeddings (768 dimens√µes cada + texto) em uma √∫nica transa√ß√£o Firestore, excedendo o limite de 10MB.
* **Solu√ß√£o implementada**: Redu√ß√£o do `CHUNK_BATCH_SIZE` de 400 para 10 chunks por batch, garantindo que cada transa√ß√£o fique abaixo do limite de 10MB.
* **Arquivos modificados**:
  - `functions/src/process_embeddings_queue.ts` (linha 251)
  - `functions/lib/process_embeddings_queue.js` (linha 244)
* **Melhorias nos coment√°rios**: Documenta√ß√£o clara sobre os limites do Firestore (500 opera√ß√µes/batch E 10MB por transa√ß√£o).
* **Build e Deploy**: 
  - `npm run build` na pasta functions
  - `firebase deploy --only functions:process_embeddings_queue`
* **Status**: ‚úÖ Deploy conclu√≠do com sucesso. A fun√ß√£o agora processa PDFs dividindo os embeddings em batches menores.
